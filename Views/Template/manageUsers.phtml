<h5>Create new user</h5>
<form action="<?= $_SERVER["PHP_SELF"] ?>?tab=<?= $page ?>" method="post">
    <div class="form-group">
        <label for="username">Username:</label>
        <input type="text" id="username" class="form-control" name="username" placeholder="Please enter your user name">
    </div>
    <div class="form-group">
        <label for="password">Password:</label>
        <input type="password" id="password" class="form-control" name="password" placeholder="Enter password">
    </div>
    <div class="form-group">
        <label for="confirm_password">Confirm Password:</label>
        <input type="password" id="confirm_password" class="form-control" name="confirm_password" placeholder="Confirm password">
    </div>
    <div class="form-group">
        <button class="btn btn-success" type="submit" name="addUser">Create User</button>
    </div>
</form>
<!-- on submit insert role value into user through the db -->

<h5>Current Users</h5>

<table class="table table-striped table-sm">
    <caption>List of users</caption>
    <thead class="thead-dark">
    <tr>
        <th scope="col">#</th>
        <th scope="col">Username</th>
        <th scope="col">Roles</th>
        <th scope="col">Groups</th>
        <th scope="col">Manage</th>
    </tr>
    </thead>
    <tbody>
    <?php foreach (User::getAllusers() as $index => $user) : ?>
        <tr id="show-<?= $user->id() ?>" class="table-row show">
            <th scope="row"><?= $index+1?></th>
            <td class="u-name">
                <span><?= $user->username() ?></span>
            </td>
            <td class="roles">
                <span><?= $user->role()->role_name ?></span>
            </td>
            <td class="groups">
                <?php foreach ($user->teams() as $team) : ?>
                    <span><?= $team ?>, </span>
                <?php endforeach; ?>
                <p class="m-0 new-group"><i class="fas fa-plus-square mr-2 text-success"></i>Add a new group...</p>
            </td>
            <td class="buttons">
                <button class="ml-auto btn btn-sm btn-success edit-btn" id="<?= $user->id() ?>">Edit</button>
                <button class="ml-auto btn btn-sm btn-danger del-btn" id="del-<?= $user->id() ?>">Delete</button>
            </td>
        </tr>
    <?php endforeach; ?>
    </tbody>
</table>

<form action="#" class="hide">
    <input type="hidden" value="" id="username-change">
</form>

<script>
    let editButtons = document.getElementsByClassName("edit-btn");
    let deleteButtons = document.getElementsByClassName("del-btn");
    let roles = <?= json_encode(Role::allRoles()) ?>;
    let groups = <?= json_encode(Group::allgroups()) ?>;

    for (let button of deleteButtons) {
        button.addEventListener("click", function() {
           let userID = this.id.substr(4);
           document.getElementById("show-" + userID).remove();

           //TODO: Send ajax request to delete user
        });
    }

</script>
